id: doa_power_detection_cpp
label: Power Detection (C++)
category: '[doa]'

templates:
  imports: from gnuradio import doa
  make: doa.power_detection_cpp(${num_inputs}, ${sample_rate}, ${buffer_size}, ${threshold_multiplier})

parameters:
- id: num_inputs
  label: Number of Inputs
  dtype: int
  default: 2
  hide: part

- id: sample_rate
  label: Sample Rate
  dtype: real
  default: samp_rate

- id: buffer_size
  label: Buffer Size
  dtype: int
  default: 1024
  hide: part

- id: threshold_multiplier
  label: Threshold Multiplier
  dtype: real
  default: 5.0
  hide: part

inputs:
- domain: stream
  dtype: complex
  multiplicity: ${num_inputs}

outputs:
- domain: stream
  dtype: complex
  multiplicity: ${num_inputs}

documentation: |-
  Power Detection Block (C++ optimized)
  0
  Detects signal power on the first input channel using dynamic threshold adjustment.
  When power exceeds the threshold, captures the signal to an internal buffer. 
  During silence periods, replays the captured signal on all channels.
  
  Parameters:
    - Number of Inputs: Number of input/output channels
    - Sample Rate: Sample rate in Hz
    - Buffer Size: Size of capture/playback buffer in samples
    - Threshold Multiplier: Multiplier for dynamic threshold (default: 5.0)
  
  The threshold is automatically calculated as: lowest_noise_floor * threshold_multiplier

file_format: 1
